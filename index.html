<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ù–∞—à –í–∏—à–ª–∏—Å—Ç | –ê—Ö–∏–ª–ª–µ—Å—É—à–∫–∞ –∏ –ê—è–Ω–æ—á–∫–∞</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        body {
            background: linear-gradient(135deg, #6a11cb 0%, #2575fc 100%);
            min-height: 100vh;
            padding: 20px;
            color: #333;
        }

        .container {
            max-width: 1100px;
            margin: 0 auto;
            background-color: rgba(255, 255, 255, 0.97);
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 15px 35px rgba(0, 0, 0, 0.2);
        }

        header {
            text-align: center;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 2px solid #f0f0f0;
        }

        header h1 {
            color: #6a11cb;
            font-size: 2.8rem;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 15px;
        }

        .subtitle {
            color: #2575fc;
            font-size: 1.2rem;
            font-weight: 500;
        }

        .controls {
            background-color: #f8f9ff;
            padding: 25px;
            border-radius: 15px;
            margin-bottom: 30px;
            box-shadow: 0 5px 15px rgba(106, 17, 203, 0.1);
        }

        .filter-section {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin-bottom: 25px;
            flex-wrap: wrap;
        }

        .filter-btn {
            padding: 10px 20px;
            border: none;
            border-radius: 50px;
            background-color: #e6e9ff;
            color: #6a11cb;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .filter-btn:hover {
            background-color: #d6d9ff;
            transform: translateY(-2px);
        }

        .filter-btn.active {
            background: linear-gradient(to right, #6a11cb, #2575fc);
            color: white;
            box-shadow: 0 4px 10px rgba(106, 17, 203, 0.3);
        }

        .add-gift-form {
            background-color: white;
            padding: 20px;
            border-radius: 12px;
            box-shadow: 0 3px 10px rgba(0, 0, 0, 0.05);
        }

        .form-row {
            display: flex;
            gap: 15px;
            margin-bottom: 15px;
            flex-wrap: wrap;
            align-items: flex-start;
        }

        .form-row:last-child {
            margin-bottom: 0;
        }

        #user-select, #category-select, #priority-select,
        #gift-name, #gift-price, #gift-link, #gift-color {
            padding: 12px 15px;
            border-radius: 10px;
            border: 2px solid #e6e9ff;
            font-size: 1rem;
            flex: 1;
            min-width: 200px;
        }

        #gift-description {
            padding: 12px 15px;
            border-radius: 10px;
            border: 2px solid #e6e9ff;
            font-size: 1rem;
            width: 100%;
            min-height: 100px;
            resize: vertical;
            font-family: inherit;
        }

        /* –ö–û–ú–ü–ê–ö–¢–ù–ê–Ø –ö–ù–û–ü–ö–ê –î–õ–Ø –§–û–¢–û */
        .photo-upload-compact {
            display: flex;
            align-items: center;
            gap: 10px;
            width: 100%;
            margin-top: 10px;
        }

        .photo-btn {
            background: linear-gradient(to right, #6a11cb, #2575fc);
            color: white;
            padding: 10px 15px;
            border-radius: 8px;
            cursor: pointer;
            display: inline-flex;
            align-items: center;
            gap: 8px;
            font-weight: 500;
            transition: all 0.3s ease;
            white-space: nowrap;
            border: none;
            font-size: 0.9rem;
        }

        .photo-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(106, 17, 203, 0.3);
        }

        .compact-preview {
            display: flex;
            align-items: center;
            gap: 10px;
            flex: 1;
        }

        .preview-image {
            max-width: 60px;
            max-height: 60px;
            border-radius: 6px;
            border: 2px solid #6a11cb;
            object-fit: cover;
        }

        .remove-photo-btn {
            background: #ff6b6b;
            color: white;
            border: none;
            padding: 6px 12px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 0.8rem;
            display: flex;
            align-items: center;
            gap: 5px;
            transition: all 0.2s ease;
        }

        .remove-photo-btn:hover {
            background: #ff5252;
        }

        #gift-name:focus, #gift-description:focus,
        #gift-link:focus, #gift-price:focus, #gift-color:focus,
        #user-select:focus, #category-select:focus, #priority-select:focus {
            outline: none;
            border-color: #6a11cb;
        }

        .form-actions {
            display: flex;
            gap: 15px;
            width: 100%;
            justify-content: center;
            margin-top: 10px;
        }

        #add-btn, #clear-btn {
            padding: 12px 25px;
            border-radius: 10px;
            border: none;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 1rem;
        }

        #add-btn {
            background: linear-gradient(to right, #6a11cb, #2575fc);
            color: white;
            flex: 2;
        }

        #clear-btn {
            background-color: #f0f0f0;
            color: #666;
            flex: 1;
        }

        #add-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(106, 17, 203, 0.3);
        }

        #clear-btn:hover {
            background-color: #e0e0e0;
            transform: translateY(-2px);
        }

        .stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: linear-gradient(135deg, #6a11cb 0%, #2575fc 100%);
            color: white;
            padding: 20px;
            border-radius: 15px;
            text-align: center;
            box-shadow: 0 5px 15px rgba(106, 17, 203, 0.2);
            transition: transform 0.3s ease;
        }

        .stat-card:hover {
            transform: translateY(-5px);
        }

        .stat-value {
            font-size: 2.5rem;
            font-weight: 700;
            margin-bottom: 5px;
        }

        .stat-label {
            font-size: 0.95rem;
            opacity: 0.9;
        }

        .gifts-container {
            min-height: 300px;
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 20px;
        }

        .gift-card {
            background-color: white;
            border-radius: 15px;
            padding: 20px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.05);
            border-top: 5px solid #6a11cb;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
            display: flex;
            flex-direction: column;
            cursor: pointer;
        }

        .gift-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 20px rgba(106, 17, 203, 0.1);
        }

        .gift-card.user2 {
            border-top-color: #2575fc;
        }

        .gift-card.priority-high {
            border-top-color: #ff416c;
        }

        .gift-card.priority-high::before {
            content: "‚òÖ";
            position: absolute;
            top: 10px;
            right: 10px;
            color: #ff416c;
            font-size: 1.2rem;
        }

        .gift-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 10px;
        }

        .gift-title {
            font-size: 1.3rem;
            font-weight: 600;
            color: #333;
            margin-bottom: 5px;
            flex: 1;
        }

        .user-badge {
            padding: 5px 12px;
            border-radius: 50px;
            font-weight: 600;
            font-size: 0.8rem;
            white-space: nowrap;
            margin-left: 10px;
        }

        .user1-badge {
            background-color: rgba(106, 17, 203, 0.1);
            color: #6a11cb;
        }

        .user2-badge {
            background-color: rgba(37, 117, 252, 0.1);
            color: #2575fc;
        }

        .gift-category {
            display: inline-block;
            padding: 3px 10px;
            background-color: #f0f0f0;
            border-radius: 50px;
            font-size: 0.8rem;
            color: #666;
            margin-bottom: 10px;
        }

        .gift-price {
            font-weight: 700;
            color: #6a11cb;
            margin-bottom: 10px;
            font-size: 1.1rem;
        }

        /* –§–û–¢–û –í –ö–ê–†–¢–û–ß–ö–ê–• */
        .gift-image-thumbnail {
            width: 100%;
            height: 150px;
            margin: 10px 0;
            border-radius: 8px;
            overflow: hidden;
            cursor: pointer;
            position: relative;
            background-color: #f5f5f5;
        }

        .gift-image-thumbnail img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            transition: transform 0.3s ease;
        }

        .gift-image-thumbnail img:hover {
            transform: scale(1.05);
        }

        .gift-image-thumbnail .no-photo {
            width: 100%;
            height: 100%;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            color: #999;
            font-size: 2rem;
        }

        .gift-description-short {
            color: #666;
            font-size: 0.95rem;
            line-height: 1.4;
            margin: 10px 0;
            flex: 1;
            display: -webkit-box;
            -webkit-line-clamp: 3;
            line-clamp: 3; 
            -webkit-box-orient: vertical;
            overflow: hidden;
        }

        .gift-link {
            display: inline-flex;
            align-items: center;
            gap: 5px;
            color: #2575fc;
            text-decoration: none;
            font-weight: 500;
            margin-top: 5px;
        }

        .gift-link:hover {
            text-decoration: underline;
        }

        .gift-actions {
            display: flex;
            gap: 10px;
            margin-top: 15px;
            justify-content: flex-end;
        }

        .action-btn {
            padding: 8px 15px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 500;
            transition: all 0.2s ease;
            display: flex;
            align-items: center;
            gap: 5px;
            font-size: 0.9rem;
        }

        .delete-btn {
            background-color: rgba(255, 99, 132, 0.1);
            color: #ff6384;
        }

        .delete-btn:hover {
            background-color: rgba(255, 99, 132, 0.2);
        }

        .purchased-btn {
            background-color: rgba(75, 192, 192, 0.1);
            color: #4bc0c0;
        }

        .purchased-btn:hover {
            background-color: rgba(75, 192, 192, 0.2);
        }

        .gift-card.purchased {
            opacity: 0.7;
            background-color: #f9f9f9;
        }

        .gift-card.purchased .gift-title {
            text-decoration: line-through;
        }

        .loading, .empty-state {
            text-align: center;
            padding: 40px;
            color: #6a11cb;
            font-size: 1.2rem;
            grid-column: 1 / -1;
        }

        footer {
            text-align: center;
            margin-top: 40px;
            padding-top: 20px;
            border-top: 2px solid #f0f0f0;
            color: #6a11cb;
            font-weight: 500;
        }

        footer .hint {
            font-size: 0.9rem;
            color: #888;
            margin-top: 5px;
        }

        .fa-heart {
            color: #ff6384;
            animation: heartbeat 1.5s infinite;
        }

        @keyframes heartbeat {
            0% { transform: scale(1); }
            5% { transform: scale(1.2); }
            10% { transform: scale(1); }
            15% { transform: scale(1.2); }
            20% { transform: scale(1); }
            100% { transform: scale(1); }
        }

        /* –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            z-index: 1000;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }

        .modal-content {
            background-color: white;
            border-radius: 15px;
            width: 100%;
            max-width: 600px;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 20px;
            border-bottom: 2px solid #f0f0f0;
        }

        .modal-header h2 {
            color: #6a11cb;
            font-size: 1.8rem;
        }

        .close-modal {
            background: none;
            border: none;
            font-size: 2rem;
            color: #666;
            cursor: pointer;
            line-height: 1;
        }

        .close-modal:hover {
            color: #333;
        }

        .modal-body {
            padding: 20px;
        }

        .modal-details {
            display: grid;
            gap: 15px;
        }

        .detail-row {
            display: flex;
            padding-bottom: 10px;
            border-bottom: 1px solid #f0f0f0;
        }

        .detail-label {
            font-weight: 600;
            color: #6a11cb;
            min-width: 150px;
        }

        .detail-value {
            color: #333;
            flex: 1;
        }

        .modal-image-container {
            width: 100%;
            margin-bottom: 20px;
            border-radius: 10px;
            overflow: hidden;
        }

        .modal-image {
            width: 100%;
            max-height: 300px;
            object-fit: contain;
        }

        .modal-link {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            color: #2575fc;
            text-decoration: none;
            font-weight: 500;
            padding: 8px 15px;
            background-color: rgba(37, 117, 252, 0.1);
            border-radius: 8px;
            margin-top: 5px;
        }

        .modal-link:hover {
            background-color: rgba(37, 117, 252, 0.2);
        }

        /* –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –¥–ª—è —Ñ–æ—Ç–æ */
        .image-modal-content {
            background: transparent;
            border: none;
            box-shadow: none;
            max-width: 90vw;
            max-height: 90vh;
            width: auto;
            position: relative;
        }

        .image-modal-content .close-modal {
            position: absolute;
            top: 20px;
            right: 20px;
            background: rgba(0,0,0,0.7);
            color: white;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1001;
        }

        #full-image {
            max-width: 100%;
            max-height: 80vh;
            border-radius: 10px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
        }

        /* –ê–¥–∞–ø—Ç–∏–≤–Ω–æ—Å—Ç—å */
        @media (max-width: 768px) {
            .container {
                padding: 20px;
            }
            
            header h1 {
                font-size: 2.2rem;
            }
            
            .form-row {
                flex-direction: column;
            }
            
            #user-select, #category-select, #priority-select,
            #gift-name, #gift-price, #gift-link, #gift-color {
                min-width: 100%;
            }
            
            .form-actions {
                flex-direction: column;
            }
            
            .gifts-container {
                grid-template-columns: 1fr;
            }
            
            .stats {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .photo-upload-compact {
                flex-direction: column;
                align-items: stretch;
            }
            
            .compact-preview {
                justify-content: center;
            }
        }

        @media (max-width: 480px) {
            .stats {
                grid-template-columns: 1fr;
            }
            
            .filter-section {
                flex-direction: column;
                align-items: center;
            }
            
            .filter-btn {
                width: 100%;
                max-width: 250px;
            }
        }

        .error {
            text-align: center;
            padding: 40px;
            color: #ff6b6b;
            font-size: 1.1rem;
            grid-column: 1 / -1;
            background-color: rgba(255, 107, 107, 0.1);
            border-radius: 10px;
            border: 1px solid rgba(255, 107, 107, 0.3);
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1><i class="fas fa-heart"></i> –ù–∞—à –í–∏—à–ª–∏—Å—Ç</h1>
            <p class="subtitle">–ê—Ö–∏–ª–ª–µ—Å—É—à–∫–∞ üíô –∏ –ê—è–Ω–æ—á–∫–∞ üíñ</p>
        </header>

        <div class="controls">
            <div class="filter-section">
                <button class="filter-btn active" data-filter="all">–í—Å–µ –ø–æ–¥–∞—Ä–∫–∏</button>
                <button class="filter-btn" data-filter="user1">–î–ª—è –ê—Ö–∏–ª–ª–µ—Å–∞</button>
                <button class="filter-btn" data-filter="user2">–î–ª—è –ê—è–Ω–æ—á–∫–∏</button>
                <button class="filter-btn" data-filter="priority">–í–∞–∂–Ω—ã–µ ‚ù§Ô∏è</button>
            </div>
            
            <div class="add-gift-form">
                <div class="form-row">
                    <select id="user-select">
                        <option value="user1">üéÅ –î–ª—è –ê—Ö–∏–ª–ª–µ—Å–∞</option>
                        <option value="user2">üéÄ –î–ª—è –ê—è–Ω–æ—á–∫–∏</option>
                    </select>
                    
                    <select id="category-select">
                        <option value="">–ö–∞—Ç–µ–≥–æ—Ä–∏—è</option>
                        <option value="–û–¥–µ–∂–¥–∞">üëï –û–¥–µ–∂–¥–∞</option>
                        <option value="–≠–ª–µ–∫—Ç—Ä–æ–Ω–∏–∫–∞">üì± –≠–ª–µ–∫—Ç—Ä–æ–Ω–∏–∫–∞</option>
                        <option value="–ö–æ—Å–º–µ—Ç–∏–∫–∞">üíÑ –ö–æ—Å–º–µ—Ç–∏–∫–∞</option>
                        <option value="–ö–Ω–∏–≥–∏">üìö –ö–Ω–∏–≥–∏</option>
                        <option value="–î–ª—è –¥–æ–º–∞">üè† –î–ª—è –¥–æ–º–∞</option>
                        <option value="–•–æ–±–±–∏">üé® –•–æ–±–±–∏</option>
                        <option value="–î—Ä—É–≥–æ–µ">üéØ –î—Ä—É–≥–æ–µ</option>
                    </select>
                    
                    <select id="priority-select">
                        <option value="normal">‚≠ê –û–±—ã—á–Ω—ã–π</option>
                        <option value="high">‚ù§Ô∏è –í–∞–∂–Ω—ã–π</option>
                        <option value="low">üå± –ù–µ —Å—Ä–æ—á–Ω–æ</option>
                    </select>
                </div>
                
                <div class="form-row">
                    <input type="text" id="gift-name" placeholder="–ù–∞–∑–≤–∞–Ω–∏–µ –ø–æ–¥–∞—Ä–∫–∞ *" required>
                    <input type="text" id="gift-price" placeholder="–¶–µ–Ω–∞ (—Ä—É–±.)">
                </div>
                
                <div class="form-row">
                    <input type="url" id="gift-link" placeholder="–°—Å—ã–ª–∫–∞ –Ω–∞ —Ç–æ–≤–∞—Ä (–µ—Å–ª–∏ –µ—Å—Ç—å)">
                    <input type="text" id="gift-color" placeholder="–¶–≤–µ—Ç / –†–∞–∑–º–µ—Ä">
                </div>
                
                <div class="form-row">
                    <textarea id="gift-description" placeholder="–û–ø–∏—Å–∞–Ω–∏–µ –ø–æ–¥–∞—Ä–∫–∞, –ø–æ—á–µ–º—É —Ö–æ—á–µ—Ç—Å—è..."></textarea>
                    
                    <div class="photo-upload-compact">
                        <label for="gift-photo" class="photo-btn">
                            <i class="fas fa-camera"></i> –î–æ–±–∞–≤–∏—Ç—å —Ñ–æ—Ç–æ
                        </label>
                        <input type="file" id="gift-photo" accept="image/*" style="display: none;">
                        <div id="photo-preview" class="compact-preview"></div>
                    </div>
                </div>
                
                <div class="form-row">
                    <div class="form-actions">
                        <button id="add-btn"><i class="fas fa-plus-circle"></i> –î–æ–±–∞–≤–∏—Ç—å –ø–æ–¥–∞—Ä–æ–∫</button>
                        <button id="clear-btn"><i class="fas fa-broom"></i> –û—á–∏—Å—Ç–∏—Ç—å —Ñ–æ—Ä–º—É</button>
                    </div>
                </div>
            </div>
        </div>

        <div class="stats">
            <div class="stat-card">
                <div class="stat-value" id="total-gifts">0</div>
                <div class="stat-label">–í—Å–µ–≥–æ –ø–æ–¥–∞—Ä–∫–æ–≤</div>
            </div>
            <div class="stat-card">
                <div class="stat-value" id="user1-gifts">0</div>
                <div class="stat-label">–î–ª—è –ê—Ö–∏–ª–ª–µ—Å–∞</div>
            </div>
            <div class="stat-card">
                <div class="stat-value" id="user2-gifts">0</div>
                <div class="stat-label">–î–ª—è –ê—è–Ω–æ—á–∫–∏</div>
            </div>
        </div>

        <div class="gifts-container">
            <div class="loading">–ó–∞–≥—Ä—É–∑–∫–∞ –ø–æ–¥–∞—Ä–∫–æ–≤...</div>
        </div>

        <footer>
            <p>–°–æ–∑–¥–∞–Ω–æ —Å –ª—é–±–æ–≤—å—é –¥–ª—è –Ω–∞—à–µ–≥–æ —É–¥–æ–±—Å—Ç–≤–∞ <i class="fas fa-heart"></i></p>
            <p class="hint">üí° –ù–∞–∂–º–∏—Ç–µ –Ω–∞ –ø–æ–¥–∞—Ä–æ–∫, —á—Ç–æ–±—ã —É–≤–∏–¥–µ—Ç—å —Ñ–æ—Ç–æ –∏ –ø–æ–¥—Ä–æ–±–Ω–æ—Å—Ç–∏</p>
        </footer>
    </div>

    <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ -->
    <div class="modal" id="gift-modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>–ü–æ–¥—Ä–æ–±–Ω–æ—Å—Ç–∏ –ø–æ–¥–∞—Ä–∫–∞</h2>
                <button class="close-modal">&times;</button>
            </div>
            <div class="modal-body">
                <!-- –°–æ–¥–µ—Ä–∂–∏–º–æ–µ –∑–∞–ø–æ–ª–Ω—è–µ—Ç—Å—è JavaScript -->
            </div>
        </div>
    </div>

    <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –¥–ª—è –ø–æ–ª–Ω–æ—Ä–∞–∑–º–µ—Ä–Ω–æ–≥–æ —Ñ–æ—Ç–æ -->
    <div class="modal full-image-modal" id="full-image-modal">
        <div class="modal-content image-modal-content">
            <button class="close-modal">&times;</button>
            <img id="full-image" src="" alt="–ü–æ–ª–Ω–æ–µ —Ñ–æ—Ç–æ">
        </div>
    </div>

    <!-- –ü–æ–¥–∫–ª—é—á–∞–µ–º Firebase -->
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>
    
    <script>
        // –í–µ—Å—å JavaScript –∫–æ–¥ –≤ –æ–¥–Ω–æ–º —Ñ–∞–π–ª–µ
        // –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è Firebase
        const firebaseConfig = {
            apiKey: "AIzaSyAQaE-RUlP-9l9KqUPUV_2pNpON7Oat9NY",
            authDomain: "wishlistforayanakilla.firebaseapp.com",
            projectId: "wishlistforayanakilla",
            storageBucket: "wishlistforayanakilla.firebasestorage.app",
            messagingSenderId: "974705587471",
            appId: "1:974705587471:web:640be35d883f65fddbfa7a",
            measurementId: "G-XWR9K2VE37"
        };

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è Firebase
        let db = null;
        let unsubscribe = null;

        // –≠–ª–µ–º–µ–Ω—Ç—ã DOM
        const giftsContainer = document.querySelector('.gifts-container');
        const addBtn = document.getElementById('add-btn');
        const clearBtn = document.getElementById('clear-btn');
        const filterBtns = document.querySelectorAll('.filter-btn');
        const modal = document.getElementById('gift-modal');
        const fullImageModal = document.getElementById('full-image-modal');
        const closeModal = document.querySelectorAll('.close-modal');
        const modalBody = document.querySelector('.modal-body');
        const fullImage = document.getElementById('full-image');

        // –§–æ—Ä–º–æ–≤—ã–µ —ç–ª–µ–º–µ–Ω—Ç—ã
        const userSelect = document.getElementById('user-select');
        const categorySelect = document.getElementById('category-select');
        const prioritySelect = document.getElementById('priority-select');
        const giftName = document.getElementById('gift-name');
        const giftPrice = document.getElementById('gift-price');
        const giftLink = document.getElementById('gift-link');
        const giftColor = document.getElementById('gift-color');
        const giftDescription = document.getElementById('gift-description');
        const giftPhoto = document.getElementById('gift-photo');
        const photoPreview = document.getElementById('photo-preview');

        // –°—Ç–∞—Ç–∏—Å—Ç–∏—á–µ—Å–∫–∏–µ —ç–ª–µ–º–µ–Ω—Ç—ã
        const totalGiftsEl = document.getElementById('total-gifts');
        const user1GiftsEl = document.getElementById('user1-gifts');
        const user2GiftsEl = document.getElementById('user2-gifts');

        // –¢–µ–∫—É—â–∏–π —Ñ–∏–ª—å—Ç—Ä –∏ —Ñ–æ—Ç–æ
        let currentFilter = 'all';
        let currentPhoto = null;

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è Firebase
        function initializeFirebase() {
            try {
                // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ Firebase –∑–∞–≥—Ä—É–∂–µ–Ω
                if (typeof firebase === 'undefined') {
                    console.error("Firebase –Ω–µ –∑–∞–≥—Ä—É–∂–µ–Ω");
                    showError("–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ Firebase");
                    return false;
                }
                
                // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º
                firebase.initializeApp(firebaseConfig);
                db = firebase.firestore();
                console.log("Firebase —É—Å–ø–µ—à–Ω–æ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω");
                
                // –ó–∞–≥—Ä—É–∂–∞–µ–º –¥–∞–Ω–Ω—ã–µ
                loadGifts();
                return true;
            } catch (error) {
                console.error("–û—à–∏–±–∫–∞ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ Firebase:", error);
                showError("–û—à–∏–±–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö");
                return false;
            }
        }

        // –ü–æ–∫–∞–∑–∞—Ç—å –æ—à–∏–±–∫—É
        function showError(message) {
            giftsContainer.innerHTML = `
                <div class="error">
                    <h3>${message}</h3>
                    <p>–ü–æ–ø—Ä–æ–±—É–π—Ç–µ –æ–±–Ω–æ–≤–∏—Ç—å —Å—Ç—Ä–∞–Ω–∏—Ü—É</p>
                    <button onclick="location.reload()" style="margin-top: 20px; padding: 10px 20px; background: #6a11cb; color: white; border: none; border-radius: 5px; cursor: pointer;">
                        –û–±–Ω–æ–≤–∏—Ç—å —Å—Ç—Ä–∞–Ω–∏—Ü—É
                    </button>
                </div>
            `;
        }

        // –ó–∞–≥—Ä—É–∑–∫–∞ –ø–æ–¥–∞—Ä–∫–æ–≤ –∏–∑ Firebase
        function loadGifts() {
            if (!db) {
                showError("–ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö –Ω–µ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–∞");
                return;
            }
            
            // –û—Ç–ø–∏—Å—ã–≤–∞–µ–º—Å—è –æ—Ç –ø—Ä–µ–¥—ã–¥—É—â–µ–≥–æ —Å–ª—É—à–∞—Ç–µ–ª—è
            if (unsubscribe) {
                unsubscribe();
            }
            
            // –°–æ–∑–¥–∞–µ–º –∑–∞–ø—Ä–æ—Å
            let query = db.collection('gifts').orderBy('date', 'desc');
            
            // –ü—Ä–∏–º–µ–Ω—è–µ–º —Ñ–∏–ª—å—Ç—Ä
            if (currentFilter === 'user1' || currentFilter === 'user2') {
                query = query.where('user', '==', currentFilter);
            } else if (currentFilter === 'priority') {
                query = query.where('priority', '==', 'high');
            }
            
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∑–∞–≥—Ä—É–∑–∫—É
            giftsContainer.innerHTML = '<div class="loading">–ó–∞–≥—Ä—É–∑–∫–∞ –ø–æ–¥–∞—Ä–∫–æ–≤...</div>';
            
            // –ü–æ–¥–ø–∏—Å—ã–≤–∞–µ–º—Å—è –Ω–∞ –∏–∑–º–µ–Ω–µ–Ω–∏—è –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏
            unsubscribe = query.onSnapshot((snapshot) => {
                const gifts = [];
                snapshot.forEach((doc) => {
                    gifts.push({
                        id: doc.id,
                        ...doc.data()
                    });
                });
                
                displayGifts(gifts);
                updateStats(gifts);
            }, (error) => {
                console.error("–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏:", error);
                showError("–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö");
            });
        }

        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏
        function updateStats(gifts) {
            const total = gifts.length;
            const user1Count = gifts.filter(g => g.user === 'user1').length;
            const user2Count = gifts.filter(g => g.user === 'user2').length;
            
            totalGiftsEl.textContent = total;
            user1GiftsEl.textContent = user1Count;
            user2GiftsEl.textContent = user2Count;
        }

        // –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –ø–æ–¥–∞—Ä–∫–æ–≤
        function displayGifts(gifts) {
            // –°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞
            gifts.sort((a, b) => {
                if (a.priority === 'high' && b.priority !== 'high') return -1;
                if (a.priority !== 'high' && b.priority === 'high') return 1;
                if (a.purchased && !b.purchased) return 1;
                if (!a.purchased && b.purchased) return -1;
                return new Date(b.date) - new Date(a.date);
            });
            
            // –û—á–∏—Å—Ç–∫–∞ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞
            giftsContainer.innerHTML = '';
            
            // –ï—Å–ª–∏ –Ω–µ—Ç –ø–æ–¥–∞—Ä–∫–æ–≤
            if (gifts.length === 0) {
                const message = getEmptyMessage();
                giftsContainer.innerHTML = `<div class="empty-state">${message}</div>`;
                return;
            }
            
            // –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –∫–∞–∂–¥–æ–≥–æ –ø–æ–¥–∞—Ä–∫–∞
            gifts.forEach(gift => {
                const giftElement = createGiftElement(gift);
                giftsContainer.appendChild(giftElement);
            });
        }

        // –°–æ–∑–¥–∞–Ω–∏–µ —ç–ª–µ–º–µ–Ω—Ç–∞ –ø–æ–¥–∞—Ä–∫–∞
        function createGiftElement(gift) {
            const giftCard = document.createElement('div');
            giftCard.className = `gift-card ${gift.user} ${gift.priority === 'high' ? 'priority-high' : ''} ${gift.purchased ? 'purchased' : ''}`;
            
            const userLabel = gift.user === 'user1' ? '–ê—Ö–∏–ª–ª–µ—Å—É—à–∫–∞' : '–ê—è–Ω–æ—á–∫–∞';
            const userClass = gift.user === 'user1' ? 'user1-badge' : 'user2-badge';
            const purchasedText = gift.purchased ? ' (–∫—É–ø–ª–µ–Ω–æ)' : '';
            
            // –§–æ—Ç–æ –∏–ª–∏ –∑–∞–≥–ª—É—à–∫–∞
            let photoHtml = '';
            if (gift.photo) {
                photoHtml = `
                    <div class="gift-image-thumbnail" onclick="openFullImage('${escapeHtml(gift.photo)}')">
                        <img src="${gift.photo}" alt="${escapeHtml(gift.name)}">
                    </div>
                `;
            } else {
                photoHtml = `
                    <div class="gift-image-thumbnail">
                        <div class="no-photo">
                            <i class="fas fa-image"></i>
                        </div>
                    </div>
                `;
            }
            
            // –û–±—Ä–µ–∑–∞–µ–º –æ–ø–∏—Å–∞–Ω–∏–µ
            const shortDescription = gift.description && gift.description.length > 100 
                ? gift.description.substring(0, 100) + '...' 
                : gift.description || '–û–ø–∏—Å–∞–Ω–∏–µ –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç';
            
            giftCard.innerHTML = `
                <div class="gift-header">
                    <div class="gift-title">${escapeHtml(gift.name)}${purchasedText}</div>
                    <div class="user-badge ${userClass}">${userLabel}</div>
                </div>
                ${gift.category ? `<div class="gift-category">${escapeHtml(gift.category)}</div>` : ''}
                ${gift.price ? `<div class="gift-price">${formatPrice(gift.price)} —Ä—É–±.</div>` : ''}
                
                <!-- –§–û–¢–û -->
                ${photoHtml}
                
                <!-- –û–ü–ò–°–ê–ù–ò–ï -->
                <div class="gift-description-short">${escapeHtml(shortDescription)}</div>
                
                ${gift.link ? `<a href="${gift.link}" target="_blank" class="gift-link" onclick="event.stopPropagation()"><i class="fas fa-external-link-alt"></i> –°—Å—ã–ª–∫–∞ –Ω–∞ —Ç–æ–≤–∞—Ä</a>` : ''}
                
                <div class="gift-actions">
                    <button class="action-btn purchased-btn" data-id="${gift.id}">
                        <i class="fas fa-${gift.purchased ? 'undo' : 'shopping-cart'}"></i>
                        ${gift.purchased
